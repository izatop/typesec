#!/usr/bin/env bash
set -euo pipefail

fail() {
    echo @$
    exit 1
}

TARGET="$(pwd)"
SOURCE="$(realpath "${0}/../..")/files"
test -f "${TARGET}/package.json" || fail "No project's package.json found"

bun i --dev @types/bun @prettier/plugin-oxc oxlint prettier typescript
cp -r "${SOURCE}/" "${TARGET}/"

bunx npm-add-script --force -k "check" -v "bun tsc -b packages"
bunx npm-add-script --force -k "check:watch" -v "bun tsc -b packages -w"
bunx npm-add-script --force -k "test" -v "bun test"
bunx npm-add-script --force -k "test:watch" -v "bun test --watch"
bunx npm-add-script --force -k "lint" -v "oxlint"
bunx npm-add-script --force -k "up:all" -v "find packages -maxdepth 1 -mindepth 1 -type d -exec env -C {} bun update -i --latest \;"
bunx npm-add-script --force -k "up" -v "bun run up:all && bun update -i --latest"
